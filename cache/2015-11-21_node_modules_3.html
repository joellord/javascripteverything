<!DOCTYPE html><html lang="en"><head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Random thoughts from a random dev">
    <meta name="author" content="Joel Lord">
    <meta name="og:type" content="website">
    <meta name="og:url" content="http://www.javascripteverything.com">
    <meta name="og:title" content="Creating Node Modules" id="ogTitle">
    <meta name="og:description" content="Part 3 - Testing" id="ogDescription">
    <meta name="og:image" content="http://javascripteverything.com/img/.jpg" id="ogImage">

    <!---— twitter card tags additive with the og: tags ---->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:domain" value="javascripteverything.com">
    <meta name="twitter:site" value="@joel__lord">
    <meta name="twitter:creator" value="@joel__lord">
    <meta name="twitter:title" value="Creating Node Modules" id="twitterTitle">
    <meta name="twitter:description" value="Part 3 - Testing" id="twitterDescription">
    <meta name="twitter:image" content="http://javascripteverything.com/img/.jpg" id="twitterImage">
    <meta name="twitter:url" value="http://javascripteverything.com/" id="twitterUrl">
    <meta name="twitter:label1" value="Next event" id="twitterLabel1">
    <meta name="twitter:data1" value="DevTeach Mtl (July 5th)" id="twitterData1">
    <meta name="twitter:label2" value="Latest blog article" id="twitterLabel2">
    <meta name="twitter:data2" value="Using clusters in Node" id="twitterData2">

    <title>Javascript Everything !</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/clean-blog.css" rel="stylesheet">
    <link href="css/site.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/default.min.css">
    <script async="" src="//www.google-analytics.com/analytics.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-70660833-1', 'auto');
        ga('send', 'pageview');

    </script>
<script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="main" src="js/main.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="start" src="js/start.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="knockout" src="js/libs/knockout.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/home-page/home" src="js/components/home-page/home.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/about-page/about" src="js/components/about-page/about.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/speaking-page/speaking" src="js/components/speaking-page/speaking.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/contact-page/contact" src="js/components/contact-page/contact.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/blog-page/blog" src="js/components/blog-page/blog.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/blog-post-page/blog-post" src="js/components/blog-post-page/blog-post.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/blog-all-page/blog-all" src="js/components/blog-all-page/blog-all.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="text" src="js/text.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="jquery" src="js/libs/jquery.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="highlight" src="js/ko_binding_highlight.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="signals" src="js/libs/signals.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="bootstrap" src="js/libs/bootstrap.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="crossroads" src="js/libs/crossroads.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="hasher" src="js/libs/hasher.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/nav-bar/nav-bar" src="js/components/nav-bar/nav-bar.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="components/ko-footer/ko-footer" src="js/components/ko-footer/ko-footer.js"></script></head>

<body>

    <!-- ko if: false --><!-- /ko -->

    <nav-bar>
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">#</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="index.html">Home</a>
                </li>
                <li>
                    <a href="about.html">About</a>
                </li>
                <li>
                    <a href="speaking.html">Speaking</a>
                </li>
                <li>
                    <a href="blog.html">Blogging</a>
                </li>
                <li>
                    <a href="contact.html">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav></nav-bar>


    <!-- ko component: {
      name: route,
      params: params
    } --><!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header" data-bind="style: {backgroundImage: bgImg}" style="background-image: url(http://javascripteverything.com/img/post-bg.jpg); ">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading smaller-heading">
                    <h1 data-bind="text: title">Creating Node Modules</h1>
                    <h2 class="subheading" data-bind="text: subtitle">Part 3 - Testing</h2>
                    <span class="meta">Posted by <a data-bind="attr: {href: authorLink}, text: author" href="about.html">Joel Lord</a> on <span data-bind="text: formattedDate">November 21th, 2015</span></span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" data-bind="html: postContent, syntaxhighlight: postContent"><p>Now that you've <a href="2015-11-18_node_modules_1.html" target="_blank">built your own module</a> and that you've <a href="2015-11-20_node_modules_2.html" target="_blank">created and maintained a package.json file</a>, you need to be sure that your module is actually tested.</p>

<h2 class="section-heading">What is unit testing</h2>

<p>Unit testing makes sure that all of your methods in your module are returning the expected data.  By enforcing unit testing, you add an extra safety net so that when you add new features to your module, you can see if you break anything which would make this backward incompatible.</p>

<h2 class="section-heading">Reorganize the folder structure</h2>

<p>Before we get started, you will need to reorganize your folder structure a bit.  If you start with the module you created in <a href="2015-11-18_node_modules_1.html" target="_blank">part 1</a>, you will need to move the files in a src folder.  This will let you create a test folder at the root of the module folder.  The package.json file should stay at the root of the folder.  The new file structure should look like this.</p>
<pre class="hljs perl">/test
/example
    <span class="hljs-keyword">index</span>.js
/src
    randomNumber.js
<span class="hljs-keyword">package</span>.json
</pre>

<p>You will notice that we moved the index.js in the example folder and that the only file in the src folder is the randomNumber.js file.  We will now rename the randomNumber.js file to index.js as this is the main file for our module.  Our final folder structure should look like.</p>
<pre class="hljs perl">/test
/example
    <span class="hljs-keyword">index</span>.js
/src
    <span class="hljs-keyword">index</span>.js
<span class="hljs-keyword">package</span>.json
</pre>
<p>Because we moved the randomNumber.js file, we now have to manually update the package.json so that the "main" property is now "src/index.js" rather than "randomNumber.js".</p>

<h2 class="section-heading">Add the testing framework</h2>

<p>Let's get ready to do some testing.  In order to do so, we will need to add some packages to our project.  Let's add Mocha as a testing framework and Chai for assertions.</p>

<pre class="hljs sql">npm <span class="hljs-operator"><span class="hljs-keyword">install</span> mocha <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> chai <span class="hljs-comment">--save-dev</span>
</span></pre>

<p>This should have added the node_modules folder to your project with the chai and mocha libraries in it.  Because we added the --save-dev flag, it should have also update the package.json so that those libraries are now dependencies of this module.</p>

<h2 class="section-heading">Create a test file</h2>
<p>Let's now add a test file for our project.  We will ensure that our random number are valid by running the tests a few times.  We will also make sure that setMin and setMax only accept numbers.</p>
<p>This is the test file that we are using</p>
<pre class="hljs javascript"><span class="hljs-comment">// test/index.js</span>
<span class="hljs-keyword">var</span> expect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).expect;
<span class="hljs-keyword">var</span> randomNumber = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../src/index'</span>);
describe(<span class="hljs-string">'#randomNumber'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    it(<span class="hljs-string">'should be a number greater than 0 and smaller than 100'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
          <span class="hljs-keyword">var</span> result = randomNumber.generate();
          expect(result).to.be.above(<span class="hljs-number">0</span>);
          expect(result).to.be.below(<span class="hljs-number">100</span>);
      }
    });
    it(<span class="hljs-string">"should always be greater than the minimum value and lower than the maximum value"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> min = <span class="hljs-number">5</span>;
      <span class="hljs-keyword">var</span> max = <span class="hljs-number">7</span>;
      randomNumber.setMin(min);
      randomNumber.setMax(max);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
        <span class="hljs-keyword">var</span> result = randomNumber.generate();
        expect(result).to.be.above(min);
        expect(result).to.be.below(max);
      }
    });
    it(<span class="hljs-string">"should accept number for setMin"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> val = randomNumber.setMin(<span class="hljs-string">"notANumber"</span>);
      expect(val).to.be.a(<span class="hljs-string">"number"</span>);
    });
    it(<span class="hljs-string">"should accept number for setMax"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> val = randomNumber.setMax(<span class="hljs-string">"notANumber"</span>);
      expect(val).to.be.a(<span class="hljs-string">"number"</span>);
    })
});
</pre>

<h2 class="section-heading">Run those tests</h2>
<p>Let's now try to run those tests.  In your command line, type the following</p>
<pre class="hljs bash">mocha <span class="hljs-built_in">test</span>
</pre>
<p>This will run the index.js file found in the test folder.  If you've followed me so far, your tests should be passed at 50%.  The last 2 will fail as we have not built a testable code for those.</p>
<pre class="hljs cpp">SYS0635:~ jlord$ mocha test


<span class="hljs-preprocessor">#randomNumber</span>
✓ should be a number greater than <span class="hljs-number">0</span> and smaller than <span class="hljs-number">100</span>
✓ should always be greater than the minimum value and lower than the maximum value
<span class="hljs-number">1</span>) should accept number <span class="hljs-keyword">for</span> setMin
<span class="hljs-number">2</span>) should accept number <span class="hljs-keyword">for</span> setMax


<span class="hljs-number">2</span> passing (<span class="hljs-number">17</span>ms)
<span class="hljs-number">2</span> failing

<span class="hljs-number">1</span>) <span class="hljs-preprocessor">#randomNumber should accept number for setMin:</span>
 AssertionError: expected undefined to be a number
  at Context.&lt;anonymous&gt; (~/nodemodules/test/index.js:<span class="hljs-number">25</span>:<span class="hljs-number">25</span>)
....
<span class="hljs-number">2</span>) <span class="hljs-preprocessor">#randomNumber should accept number for setMax:</span>
AssertionError: expected undefined to be a number
at Context.&lt;anonymous&gt; (~/nodemodules/test/index.js:<span class="hljs-number">29</span>:<span class="hljs-number">25</span>)
....
</pre>

<h2 class="section-heading">Make all methods testable</h2>
<p>Finally, we will make our setMin and setMax methods testable.  In order to make so, we need to return a value.  For those methods, we will return the value that is being set as a min/max.  If the parameter is not a number, it should use default values.  The new functions should look like this.</p>
<pre class="hljs cs"><span class="hljs-comment">// src/index.js</span>
....
<span class="hljs-comment">//Expose a function to set the minimum random</span>
<span class="hljs-comment">//value</span>
<span class="hljs-keyword">public</span>.setMin = function(<span class="hljs-keyword">value</span>) {
  <span class="hljs-keyword">if</span> (isNaN(<span class="hljs-keyword">value</span>)) <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;
  min = <span class="hljs-keyword">value</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>;
}

<span class="hljs-comment">//Expose a function to set the maximum random</span>
<span class="hljs-comment">//value to be returned</span>
<span class="hljs-keyword">public</span>.setMax = function(<span class="hljs-keyword">value</span>) {
  <span class="hljs-keyword">if</span> (isNaN(<span class="hljs-keyword">value</span>)) <span class="hljs-keyword">value</span> = <span class="hljs-number">100</span>;
  max = <span class="hljs-keyword">value</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>;
}
....
</pre>

<p>We have now added a default value and a returned value.  We can now run those tests again.</p>

<pre class="hljs bash">mocha <span class="hljs-built_in">test</span>
</pre>

<p>And it should now be 4 passed out of 4.</p>

<h2 class="section-heading">Add to the package.json file</h2>
<p>Let's keep our package.json file up to date.  Now that we added a test framework, we should let npm run those tests for us.</p>
<p>Add the scripts property to the packages.json and enter the bash command to run the tests there.</p>
<pre class="hljs cpp"><span class="hljs-comment">//package.json</span>
....
<span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"test"</span>: <span class="hljs-string">"mocha test"</span>
},
....
</pre>

<h2 class="section-heading">Test it with npm</h2>
<p>Now that you've added the testing script to the package.json file, you should be able to run your tests using npm test.</p>
<pre class="hljs bash">SYS0635:~ jlord$ npm <span class="hljs-built_in">test</span>

&gt; random-number-gen@<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span> <span class="hljs-built_in">test</span> /path/to/randomnumber
&gt; mocha <span class="hljs-built_in">test</span>

<span class="hljs-comment">#randomNumber</span>
✓ should be a number greater than <span class="hljs-number">0</span> and smaller than <span class="hljs-number">100</span>
✓ should always be greater than the minimum value and lower than the maximum value
✓ should accept number <span class="hljs-keyword">for</span> <span class="hljs-built_in">set</span>M<span class="hljs-keyword">in</span>
✓ should accept number <span class="hljs-keyword">for</span> <span class="hljs-built_in">set</span>Max


<span class="hljs-number">4</span> passing (<span class="hljs-number">13</span>ms)
</pre>

<h2 class="section-heading">Summary</h2>
<p>And that's it, you now have a node module with a testing framework.  You are now very close to being able to publish.  Stay tuned for our next blog post in this series !</p></div>
        </div>
    </div>
</article>
<!-- /ko -->

    <hr>

    <!-- Footer -->
    <ko-footer><footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="http://www.twitter.com/joel__lord" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://ca.linkedin.com/in/joel-lord-9099b232" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="http://www.github.com/joellord" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                    </li>
                    <li>
                        <a href="mailto:me@joel-lord.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                </ul>
                <p class="copyright text-muted">Copyright © Joel Lord <span data-bind="text: year">2016</span></p>
                <p class="copyright text-muted">Built on top of <a href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a></p>
            </div>
        </div>
    </div>
</footer></ko-footer>


    





</body></html>